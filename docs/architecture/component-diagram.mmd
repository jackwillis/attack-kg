%%{init: {'theme': 'base'}}%%

graph LR
    subgraph KB["Knowledge Base (800+ Techniques)"]
        direction TB
        T1["Techniques<br/><i>attack-pattern</i>"]
        G1["Groups<br/><i>intrusion-set</i>"]
        S1["Software<br/><i>malware/tool</i>"]
        M1["Mitigations<br/><i>course-of-action</i>"]
        TC["Tactics<br/><i>kill-chain-phase</i>"]
        DS["Data Sources<br/><i>x-mitre-data-source</i>"]
        DET["Detection Strategies<br/><i>x-mitre-detection-strategy</i>"]
    end

    subgraph D3F["D3FEND (500+ Techniques)"]
        direction TB
        D1["Defensive Techniques<br/><i>d3f:DefensiveTechnique</i>"]
        D2["Digital Artifacts<br/><i>d3f:DigitalArtifact</i>"]
    end

    subgraph ExtSources["External Tool Mappings"]
        direction TB
        LB["LOLBAS<br/><i>Windows LOLBins</i><br/>certutil, mshta, etc."]
        GT["GTFOBins<br/><i>Linux Binaries</i><br/>curl, wget, etc."]
    end

    subgraph Relations["RDF Relationships"]
        direction TB
        R1["attack:uses"]
        R2["attack:mitigates"]
        R3["attack:subtechniqueOf"]
        R4["attack:tactic"]
        R5["d3f:counters"]
    end

    subgraph Queries["Query Capabilities"]
        direction TB
        Q1["Technique Lookup<br/><i>get_technique(T1110.003)</i>"]
        Q2["Group Analysis<br/><i>get_techniques_for_group(APT29)</i>"]
        Q3["Mitigation Mapping<br/><i>get_mitigations_for_technique()</i>"]
        Q4["Hybrid Search<br/><i>BM25 + Semantic + RRF</i>"]
        Q5["Two-Stage Analysis<br/><i>NodeSelector â†’ RemediationWriter</i>"]
        Q6["D3FEND Countermeasures<br/><i>countermeasures T1110.003</i>"]
        Q7["Kill Chain Expansion<br/><i>Adjacent tactic techniques</i>"]
    end

    T1 --- R1
    G1 --- R1
    S1 --- R1
    T1 --- R2
    M1 --- R2
    T1 --- R3
    T1 --- R4
    TC --- R4
    D1 --- R5
    M1 --- R5

    R1 --> Q1
    R1 --> Q2
    R2 --> Q3
    R3 --> Q1
    R4 --> Q4
    R4 --> Q7
    Q1 --> Q5
    Q4 --> Q5
    Q7 --> Q5
    R5 --> Q6

    LB --> Q4
    GT --> Q4
    DS --> Q5
    DET --> Q5

    classDef entity fill:#E8F4F8,stroke:#4A90A4
    classDef defense fill:#D4EDDA,stroke:#28A745
    classDef external fill:#FFE4B5,stroke:#D4A574
    classDef relation fill:#FFF3CD,stroke:#FFC107
    classDef query fill:#E2E3E5,stroke:#6C757D

    class T1,G1,S1,M1,TC,DS,DET entity
    class D1,D2 defense
    class LB,GT external
    class R1,R2,R3,R4,R5 relation
    class Q1,Q2,Q3,Q4,Q5,Q6,Q7 query
